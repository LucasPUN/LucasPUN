name: Generate Snake Animation

on:
  schedule:
    - cron: "0 0 * * *"  # 每天运行一次
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # Step 1: 创建 dist 目录
      - name: Create dist directory
        run: |
          mkdir -p dist

      # Step 2: 运行 Platane/snk，生成 snake.svg 到 dist 目录
      - uses: Platane/snk@v3
        with:
          github_user_name: LucasPUN
          outputs: dist/snake.svg

      # Step 3: 初始化 Git 仓库
      - name: Initialize git repository
        run: |
          git init
          git config --global user.name "LucasPUN"
          git config --global user.email "lucas_3_2_1@hotmail.com"  # 请替换为你的电子邮件

      # Step 4: 将 master 分支重命名为 main（如果需要）
      - name: Rename branch to main
        run: |
          git branch -m master main  # 如果当前分支是 master，则重命名为 main

      # Step 5: 设置远程仓库链接
      - name: Add remote repository
        run: |
          git remote add origin https://github.com/LucasPUN/LucasPUN.git

      # Step 6: 拉取远程仓库的最新更新
      - name: Pull from remote repository
        run: |
          git pull origin main --rebase

      # Step 7: 提交并推送生成的文件
      - name: Commit and Push Snake Animation
        run: |
          git add dist/snake.svg
          git commit -m "Add snake animation"
          git push -u origin main

      # Step 8: 上传生成的动画文件
      - name: Upload Snake Animation
        uses: actions/upload-artifact@v4
        with:
          name: snake-animation
          path: dist/snake.svg
